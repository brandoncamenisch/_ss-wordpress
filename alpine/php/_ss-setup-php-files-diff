#!/bin/sh
# Master has different rules because it can't compare against itself and needs to only test the latest commit
export COMMIT="$(git rev-parse --short HEAD)"
export COMMIT_DIFF="/tmp/${WORDPRESS_THEME}-${COMMIT}.diff"
export PHP_FILES="/tmp/${WORDPRESS_THEME}-${COMMIT}-php-files.diff"

if [ "master" = "$(git rev-parse --abbrev-ref HEAD)" ]
	then
		# Make a file for the commit diff to read into tests a variable is too large
		(git --no-pager diff --diff-filter=d --no-commit-id "$(git rev-parse --short HEAD^)") > "${COMMIT_DIFF}"
		(git --no-pager diff --diff-filter=d --no-commit-id --name-only "$(git rev-parse --short HEAD^)" -- '*.php') > "${PHP_FILES}"
	else
		(git --no-pager diff origin/master --diff-filter=d --no-commit-id) > "${COMMIT_DIFF}"
		(git --no-pager diff origin/master --diff-filter=d --name-only -- '*.php') > "${PHP_FILES}"
fi
